<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Mapbox GL JS Marker with 3D Cube</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.5.1/mapbox-gl.css' rel='stylesheet' />

    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body>

<div id='map'></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoia3VhbmdrZW5nIiwiYSI6ImNsNXVibXhrNzBlNzUzamxhaHlrbHJsemcifQ.pi3jb5qDip_6YHTMDxDO5Q';

    var markers = [
    [105.189954,16.051838],
    [104.82198,15.25313],
    [104.82998,15.24469],
    [105.374764,15.985109],
    [102.682091,17.845641],
    [102.95844,17.99933],
[102.948458,17.997836],
[102.943089,18.001037],
[103.03492,17.97103],
[103.0739,18.08222],
[103.08625,18.05407],
[102.49457,17.96497],
[102.49447,17.964979],
[103.286253,18.293866],
[103.280312,18.29153],
[104.832911,16.458152],
[104.837911,16.454378],
[104.872743,16.381279],
[104.876039,16.373611],
[104.742152,16.648107],
[104.737349,16.625798],
[104.7442,16.651531],
[104.741196,16.644206],
[104.742756,16.650371],
[104.745758,16.659437],
[103.44795,18.42652],
[103.363753,18.434035],
[103.377186,18.436366],
[103.359841,18.433486],
[103.44812,18.4264],
[103.770625,18.340361],
[103.773006,18.341067],
[103.775214,18.341171],
[103.834314,18.319981],
[103.75943,18.28901],
[103.771809,18.340866],
[103.819895,18.333079],
[103.818452,18.333813],
[103.832979,18.322471],
[103.842266,18.301356],
[103.825019,18.330469],
[103.832107,18.324137],
[103.837199,18.314277],
[103.53018,18.42123],
[104.1661,18.0402],
[104.17157,18.02691],
[104.1546,18.05113],
[104.14481,18.03404],
[104.074342,18.179618],
[104.79481,17.18036],
[104.79184,17.36636],
[104.794479,17.369021],
[104.570035,17.594663],
[104.565541,17.596769],
[104.570689,17.59409],
[104.570035,17.594663],
[104.570035,17.594663],
[104.570035,17.594663],
[104.570035,17.594663],
[104.570035,17.594663],
[104.570035,17.594663],
[104.570035,17.594663],
[104.570035,17.594663],
[104.533015,17.615031],
[104.534496,17.614233],
[104.53442,17.613916],
[104.535622,17.613426],
[104.424263,17.707594],
[104.6828,17.534498],
[104.666256,17.541751],
[104.66455,17.542273],
[104.670172,17.540022],
[104.667318,17.541199],
[104.66455,17.542273],
[104.673251,17.538324],
[104.673251,17.538324],
[104.674066,17.537945],
[104.675472,17.53724],
[104.168138,18.040016],
[104.189683,18.016185],
[104.74792,16.84131],
[104.74792,16.84131],
[101.74181,17.61907],
[101.58121,17.854],
[101.5778,17.86395],
[101.57741,17.86397],
[101.57959,17.85885],
[101.58028,17.85667],
[101.5799,17.85759],
[101.57811,17.86424],
[101.57513,17.86465],
[101.581012,17.856268],
[101.5829,17.851753],
[101.57811,17.86424],
[100.12006,20.23011],
];


    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/kuangkeng/clg69hdtt001j01qxvpnpquag',
        center: [103.3, 16.7],
        zoom: 8,
        pitch: 60
    });

    // for (var i = 0; i < markers.length; i++) {
    //     var cubeGeoJSON = {
    //         "type": "FeatureCollection",
    //         "features": [{
    //             "type": "Feature",
    //             "properties": {height: 1000,},
    //             "geometry": {
    //                 "type": "Polygon",
    //                 "coordinates": [[
    //                     [markers[i][0]-0.005, markers[i][1]-0.005],
    //                     [markers[i][0]+0.005, markers[i][1]-0.005],
    //                     [markers[i][0]+0.005, markers[i][1]+0.005],
    //                     [markers[i][0]-0.005, markers[i][1]+0.005],
    //                     [markers[i][0]-0.005, markers[i][1]-0.005],
    //                 ]]
    //             }
    //         }]
    //     };

    //     var cubeLayer = {
    //         'id': 'cube' + i,
    //         'type': 'fill-extrusion',
    //         'source': {
    //             'type': 'geojson',
    //             'data': cubeGeoJSON
    //         },
    //         'paint': {
    //             'fill-extrusion-color': '#f00',
    //             'fill-extrusion-height': {
    //                 'type': 'identity',
    //                 'property': 'height'
    //             },
    //             'fill-extrusion-opacity': 0.8
    //         }
    //     };

    //     map.on('load', function() {
    //         map.addLayer(cubeLayer);
    //     });
    //     console.log("cube added: cube" + i)
    // }








//     for (var i = 0; i < markers.length; i++) {
//     var cubeGeoJSON = {
//         "type": "FeatureCollection",
//         "features": [{
//             "type": "Feature",
//             "properties": {height: 1000,},
//             "geometry": {
//                 "type": "Polygon",
//                 "coordinates": [[
//                     [markers[i][0]-0.005, markers[i][1]-0.005],
//                     [markers[i][0]+0.005, markers[i][1]-0.005],
//                     [markers[i][0]+0.005, markers[i][1]+0.005],
//                     [markers[i][0]-0.005, markers[i][1]+0.005],
//                     [markers[i][0]-0.005, markers[i][1]-0.005],
//                 ]]
//             }
//         }]
//     };

//     var cubeLayer = {
//         'id': 'cube' + i,
//         'type': 'fill-extrusion',
//         'source': {
//             'type': 'geojson',
//             'data': cubeGeoJSON
//         },
//         'paint': {
//             'fill-extrusion-color': '#f00',
//             'fill-extrusion-height': {
//                 'type': 'identity',
//                 'property': 'height'
//             },
//             'fill-extrusion-opacity': 0.8
//         }
//     };

//     console.log("cube added: cube" + i)
//     map.addLayer(cubeLayer);
// }

// map.on('load', function() {
//     console.log("All layers loaded");
// });








map.on('load', function() {
        for (var i = 0; i < markers.length; i++) {
            var cubeGeoJSON = {
                "type": "FeatureCollection",
                "features": [{
                    "type": "Feature",
                    "properties": {},
                    "geometry": {
                        "type": "Polygon",
                        "coordinates": [[
                            [markers[i][0]-0.005, markers[i][1]-0.005],
                            [markers[i][0]+0.005, markers[i][1]-0.005],
                            [markers[i][0]+0.005, markers[i][1]+0.005],
                            [markers[i][0]-0.005, markers[i][1]+0.005],
                            [markers[i][0]-0.005, markers[i][1]-0.005],
                        ]]
                    }
                }]
            };

            var cubeLayer = {
                'id': 'cube' + i,
                'type': 'fill-extrusion',
                'source': {
                    'type': 'geojson',
                    'data': cubeGeoJSON
                },
                'paint': {
                    'fill-extrusion-color': '#f00',
                    'fill-extrusion-height': 10000,
                    'fill-extrusion-opacity': 0.8
                }
            };
            map.addLayer(cubeLayer);    
        }
    });


</script>

</body>
</html>
